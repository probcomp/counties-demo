dist: trusty
sudo: required

services:
  - docker

before_install:
  # https://docs.travis-ci.com/user/docker/#Installing-a-newer-Docker-version
  - curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
  - sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
  - sudo apt-get update
  - sudo apt-get -y install docker-ce
  # https://docs.travis-ci.com/user/customizing-the-build/#Authentication
  - echo -e "machine github.com\n  login $GITHUB_TOKEN" > ~/.netrc
  - git lfs pull
  - git clone https://github.com/probcomp/nginx-proxy.git
  - git clone https://github.com/probcomp/bayesrest.git
  - pushd bayesrest
  - git checkout falcon-refactor
  - cp config-example.yaml config.yaml
  - popd
  - cp database.bdb bayesrest
script:
  - make test
after_script:
  - docker-compose down
